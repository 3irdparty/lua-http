<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>lua-http</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="site.css">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="meta">
<header>
<h1 class="title">lua-http</h1>
<h1 class="subtitle">HTTP library for Lua</h1>
</header>
<nav id="TOC">
<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#conventions">Conventions</a><ul>
<li><a href="#errors">Errors</a></li>
</ul></li>
<li><a href="#terminology">Terminology</a></li>
<li><a href="#common-use-cases">Common use cases</a><ul>
<li><a href="#retrieving-a-document">Retrieving a document</a></li>
</ul></li>
<li><a href="#asynchronous-operation">Asynchronous Operation</a></li>
</ul></li>
<li><a href="#interfaces">Interfaces</a><ul>
<li><a href="#connection">connection</a><ul>
<li><a href="#connection.type"><code>connection.type</code> <!-- --></a></li>
<li><a href="#connection.version"><code>connection.version</code> <!-- --></a></li>
</ul></li>
<li><a href="#stream">stream</a><ul>
<li><a href="#stream.connection"><code>stream.connection</code> <!-- --></a></li>
<li><a href="#stream:get_headers"><code>stream:get_headers(timeout)</code> <!-- --></a></li>
<li><a href="#stream:write_headers"><code>stream:write_headers(headers, end_stream, timeout)</code> <!-- --></a></li>
<li><a href="#stream:get_next_chunk"><code>stream:get_next_chunk(timeout)</code> <!-- --></a></li>
<li><a href="#stream:write_chunk"><code>stream:write_chunk(chunk, end_stream, timeout)</code> <!-- --></a></li>
<li><a href="#stream:shutdown"><code>stream:shutdown()</code> <!-- --></a></li>
</ul></li>
</ul></li>
<li><a href="#modules">Modules</a><ul>
<li><a href="#http.bit">http.bit</a><ul>
<li><a href="#http.bit.band"><code>band(a, b)</code> <!-- --></a></li>
<li><a href="#http.bit.bor"><code>bor(a, b)</code> <!-- --></a></li>
<li><a href="#http.bit.bxor"><code>bxor(a, b)</code> <!-- --></a></li>
<li><a href="#http.bit-example">Example</a></li>
</ul></li>
<li><a href="#http.client">http.client</a><ul>
<li><a href="#http.client.connect"><code>connect(options, timeout)</code> <!-- --></a></li>
<li><a href="#http.client-example">Example</a></li>
</ul></li>
<li><a href="#http.h1_connection">http.h1_connection</a><ul>
<li><a href="#http.h1_connection.new"><code>new(socket, conn_type, version)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:checktls"><code>h1_connection:checktls()</code> <!-- --></a></li>
<li><a href="#http.h1_connection:localname"><code>h1_connection:localname()</code> <!-- --></a></li>
<li><a href="#http.h1_connection:peername"><code>h1_connection:peername()</code> <!-- --></a></li>
<li><a href="#http.h1_connection:clearerr"><code>h1_connection:clearerr(...)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:take_socket"><code>h1_connection:take_socket()</code> <!-- --></a></li>
<li><a href="#http.h1_connection:shutdown"><code>h1_connection:shutdown(dir)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:close"><code>h1_connection:close()</code> <!-- --></a></li>
<li><a href="#http.h1_connection:new_stream"><code>h1_connection:new_stream()</code> <!-- --></a></li>
<li><a href="#http.h1_connection:get_next_incoming_stream"><code>h1_connection:get_next_incoming_stream(timeout)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:read_request_line"><code>h1_connection:read_request_line(timeout)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:read_status_line"><code>h1_connection:read_status_line(timeout)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:read_header"><code>h1_connection:read_header(timeout)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:read_headers_done"><code>h1_connection:read_headers_done(timeout)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:read_body_by_length"><code>h1_connection:read_body_by_length(len, timeout)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:read_body_till_close"><code>h1_connection:read_body_till_close(timeout)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:read_body_chunk"><code>h1_connection:read_body_chunk(timeout)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:write_request_line"><code>h1_connection:write_request_line(method, path, httpversion, timeout)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:write_status_line"><code>h1_connection:write_status_line(httpversion, status_code, reason_phrase, timeout)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:write_header"><code>h1_connection:write_header(k, v, timeout)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:write_headers_done"><code>h1_connection:write_headers_done(timeout)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:write_body_chunk"><code>h1_connection:write_body_chunk(chunk, chunk_ext, timeout)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:write_body_last_chunk"><code>h1_connection:write_body_last_chunk(chunk_ext, timeout)</code> <!-- --></a></li>
<li><a href="#http.h1_connection:write_body_plain"><code>h1_connection:write_body_plain(body, timeout)</code> <!-- --></a></li>
</ul></li>
<li><a href="#http.h1_reason_phrases">http.h1_reason_phrases</a><ul>
<li><a href="#http.h1_reason_phrases-example">Example</a></li>
</ul></li>
<li><a href="#http.h1_stream">http.h1_stream</a><ul>
<li><a href="#http.h1_stream:set_state"><code>h1_stream:set_state(new)</code> <!-- --></a></li>
<li><a href="#http.h1_stream:read_headers"><code>h1_stream:read_headers(timeout)</code> <!-- --></a></li>
</ul></li>
<li><a href="#http.h2_connection">http.h2_connection</a><ul>
<li><a href="#http.h2_connection.new"><code>new(socket, conn_type, settings, timeout)</code> <!-- --></a></li>
<li><a href="#http.h2_connection:pollfd"><code>h2_connection:pollfd()</code> <!-- --></a></li>
<li><a href="#http.h2_connection:events"><code>h2_connection:events()</code> <!-- --></a></li>
<li><a href="#http.h2_connection:timeout"><code>h2_connection:timeout()</code> <!-- --></a></li>
<li><a href="#http.h2_connection:empty"><code>h2_connection:empty()</code> <!-- --></a></li>
<li><a href="#http.h2_connection:step"><code>h2_connection:step(timeout)</code> <!-- --></a></li>
<li><a href="#http.h2_connection:loop"><code>h2_connection:loop(timeout)</code> <!-- --></a></li>
<li><a href="#http.h2_connection:checktls"><code>h2_connection:checktls()</code> <!-- --></a></li>
<li><a href="#http.h2_connection:localname"><code>h2_connection:localname()</code> <!-- --></a></li>
<li><a href="#http.h2_connection:peername"><code>h2_connection:peername()</code> <!-- --></a></li>
<li><a href="#http.h2_connection:shutdown"><code>h2_connection:shutdown()</code> <!-- --></a></li>
<li><a href="#http.h2_connection:close"><code>h2_connection:close()</code> <!-- --></a></li>
<li><a href="#http.h2_connection:new_stream"><code>h2_connection:new_stream(id)</code> <!-- --></a></li>
<li><a href="#http.h2_connection:get_next_incoming_stream"><code>h2_connection:get_next_incoming_stream(timeout)</code> <!-- --></a></li>
<li><a href="#http.h2_connection:read_http2_frame"><code>h2_connection:read_http2_frame(timeout)</code> <!-- --></a></li>
<li><a href="#http.h2_connection:write_http2_frame"><code>h2_connection:write_http2_frame(typ, flags, streamid, payload, timeout)</code> <!-- --></a></li>
<li><a href="#http.h2_connection:ping"><code>h2_connection:ping(timeout)</code> <!-- --></a></li>
<li><a href="#http.h2_connection:write_window_update"><code>h2_connection:write_window_update(inc, timeout)</code> <!-- --></a></li>
<li><a href="#http.h2_connection:write_goaway_frame"><code>h2_connection:write_goaway_frame(last_stream_id, err_code, debug_msg)</code> <!-- --></a></li>
<li><a href="#http.h2_connection:set_peer_settings"><code>h2_connection:set_peer_settings(peer_settings)</code> <!-- --></a></li>
<li><a href="#http.h2_connection:ack_settings"><code>h2_connection:ack_settings()</code> <!-- --></a></li>
<li><a href="#http.h2_connection:settings"><code>h2_connection:settings(tbl, timeout)</code> <!-- --></a></li>
</ul></li>
<li><a href="#http.h2_error">http.h2_error</a><ul>
<li><a href="#http.h2_error.errors"><code>errors</code> <!-- --></a></li>
<li><a href="#http.h2_error.is"><code>is(ob)</code> <!-- --></a></li>
<li><a href="#http.h2_error:new"><code>h2_error:new(ob)</code> <!-- --></a></li>
<li><a href="#http.h2_error:traceback"><code>h2_error:traceback(message, stream_error, lvl)</code> <!-- --></a></li>
<li><a href="#http.h2_error:error"><code>h2_error:error(message, stream_error, lvl)</code> <!-- --></a></li>
<li><a href="#http.h2_error:assert"><code>h2_error:assert(cond, ...)</code> <!-- --></a></li>
</ul></li>
<li><a href="#http.h2_stream">http.h2_stream</a><ul>
<li><a href="#http.h2_stream:set_state"><code>h2_stream:set_state(new)</code> <!-- --></a></li>
<li><a href="#http.h2_stream:reprioritise"><code>h2_stream:reprioritise(child, exclusive)</code> <!-- --></a></li>
<li><a href="#http.h2_stream:write_http2_frame"><code>h2_stream:write_http2_frame(typ, flags, payload, timeout)</code> <!-- --></a></li>
<li><a href="#http.h2_stream:write_data_frame"><code>h2_stream:write_data_frame(payload, end_stream, padded, timeout)</code> <!-- --></a></li>
<li><a href="#http.h2_stream:write_headers_frame"><code>h2_stream:write_headers_frame(payload, end_stream, end_headers, padded, exclusive, stream_dep, weight, timeout)</code> <!-- --></a></li>
<li><a href="#http.h2_stream:write_rst_stream"><code>h2_stream:write_rst_stream(err_code, timeout)</code> <!-- --></a></li>
<li><a href="#http.h2_stream:write_settings_frame"><code>h2_stream:write_settings_frame(ACK, settings, timeout)</code> <!-- --></a></li>
<li><a href="#http.h2_stream:write_ping_frame"><code>h2_stream:write_ping_frame(ACK, payload, timeout)</code> <!-- --></a></li>
<li><a href="#http.h2_stream:write_goaway_frame"><code>h2_stream:write_goaway_frame(last_streamid, err_code, debug_msg, timeout)</code> <!-- --></a></li>
<li><a href="#http.h2_stream:write_window_update_frame"><code>h2_stream:write_window_update_frame(inc, timeout)</code> <!-- --></a></li>
<li><a href="#http.h2_stream:write_window_update"><code>h2_stream:write_window_update(inc)</code> <!-- --></a></li>
<li><a href="#http.h2_stream:write_continuation_frame"><code>h2_stream:write_continuation_frame(payload, end_headers, timeout)</code> <!-- --></a></li>
</ul></li>
<li><a href="#http.headers">http.headers</a><ul>
<li><a href="#http.headers.new"><code>new()</code> <!-- --></a></li>
<li><a href="#http.headers:len"><code>headers:len()</code> <!-- --></a></li>
<li><a href="#http.headers:clone"><code>headers:clone()</code> <!-- --></a></li>
<li><a href="#http.headers:append"><code>headers:append(name, value, never_index)</code> <!-- --></a></li>
<li><a href="#http.headers:each"><code>headers:each()</code> <!-- --></a></li>
<li><a href="#http.headers:has"><code>headers:has(name)</code> <!-- --></a></li>
<li><a href="#http.headers:delete"><code>headers:delete(name)</code> <!-- --></a></li>
<li><a href="#http.headers:geti"><code>headers:geti(i)</code> <!-- --></a></li>
<li><a href="#http.headers:get_as_sequence"><code>headers:get_as_sequence(name)</code> <!-- --></a></li>
<li><a href="#http.headers:get"><code>headers:get(name)</code> <!-- --></a></li>
<li><a href="#http.headers:get_comma_separated"><code>headers:get_comma_separated(name)</code> <!-- --></a></li>
<li><a href="#http.headers:get_split_as_sequence"><code>headers:get_split_as_sequence(name)</code> <!-- --></a></li>
<li><a href="#http.headers:modifyi"><code>headers:modifyi(i, value, never_index)</code> <!-- --></a></li>
<li><a href="#http.headers:upsert"><code>headers:upsert(name, value, never_index)</code> <!-- --></a></li>
<li><a href="#http.headers:sort"><code>headers:sort()</code> <!-- --></a></li>
</ul></li>
<li><a href="#http.hpack">http.hpack</a><ul>
<li><a href="#http.hpack.new"><code>new(SETTINGS_HEADER_TABLE_SIZE)</code> <!-- --></a></li>
<li><a href="#http.hpack:append_data"><code>hpack_context:append_data(val)</code> <!-- --></a></li>
<li><a href="#http.hpack:render_data"><code>hpack_context:render_data()</code> <!-- --></a></li>
<li><a href="#http.hpack:clear_data"><code>hpack_context:clear_data()</code> <!-- --></a></li>
<li><a href="#http.hpack:evict_from_dynamic_table"><code>hpack_context:evict_from_dynamic_table()</code> <!-- --></a></li>
<li><a href="#http.hpack:dynamic_table_tostring"><code>hpack_context:dynamic_table_tostring()</code> <!-- --></a></li>
<li><a href="#http.hpack:set_max_dynamic_table_size"><code>hpack_context:set_max_dynamic_table_size(SETTINGS_HEADER_TABLE_SIZE)</code> <!-- --></a></li>
<li><a href="#http.hpack:encode_max_size"><code>hpack_context:encode_max_size(val)</code> <!-- --></a></li>
<li><a href="#http.hpack:resize_dynamic_table"><code>hpack_context:resize_dynamic_table(new_size)</code> <!-- --></a></li>
<li><a href="#http.hpack:add_to_dynamic_table"><code>hpack_context:add_to_dynamic_table(name, value, k) -- luacheck: ignore 212</code> <!-- --></a></li>
<li><a href="#http.hpack:dynamic_table_id_to_index"><code>hpack_context:dynamic_table_id_to_index(id)</code> <!-- --></a></li>
<li><a href="#http.hpack:lookup_pair_index"><code>hpack_context:lookup_pair_index(k)</code> <!-- --></a></li>
<li><a href="#http.hpack:lookup_name_index"><code>hpack_context:lookup_name_index(name)</code> <!-- --></a></li>
<li><a href="#http.hpack:lookup_index"><code>hpack_context:lookup_index(index, allow_single)</code> <!-- --></a></li>
<li><a href="#http.hpack:add_header_indexed"><code>hpack_context:add_header_indexed(name, value, huffman)</code> <!-- --></a></li>
<li><a href="#http.hpack:add_header_never_indexed"><code>hpack_context:add_header_never_indexed(name, value, huffman)</code> <!-- --></a></li>
<li><a href="#http.hpack:encode_headers"><code>hpack_context:encode_headers(headers)</code> <!-- --></a></li>
<li><a href="#http.hpack:decode_headers"><code>hpack_context:decode_headers(payload, header_list, pos)</code> <!-- --></a></li>
</ul></li>
<li><a href="#http.request">http.request</a><ul>
<li><a href="#http.request.new_from_uri"><code>new_from_uri(uri)</code> <!-- --></a></li>
<li><a href="#http.request.new_connect"><code>new_connect(uri, connect_authority)</code> <!-- --></a></li>
<li><a href="#http.request.host"><code>request.host</code> <!-- --></a></li>
<li><a href="#http.request.port"><code>request.port</code> <!-- --></a></li>
<li><a href="#http.request.tls"><code>request.tls</code> <!-- --></a></li>
<li><a href="#http.request.sendname"><code>request.sendname</code> <!-- --></a></li>
<li><a href="#http.request.version"><code>request.version</code> <!-- --></a></li>
<li><a href="#http.request.headers"><code>request.headers</code> <!-- --></a></li>
<li><a href="#http.request.follow_redirects"><code>request.follow_redirects</code> <!-- --></a></li>
<li><a href="#http.request.max_redirects"><code>request.max_redirects</code> <!-- --></a></li>
<li><a href="#http.request.expect_100_timeout"><code>request.expect_100_timeout</code> <!-- --></a></li>
<li><a href="#http.request:set_body"><code>request:set_body(body)</code> <!-- --></a></li>
<li><a href="#http.request:timeout"><code>request:go(timeout)</code> <!-- --></a></li>
</ul></li>
<li><a href="#http.server">http.server</a><ul>
<li><a href="#http.client.connect"><code>listen(options)</code> <!-- --></a></li>
</ul></li>
<li><a href="#http.stream_common">http.stream_common</a><ul>
<li><a href="#http.stream_common:checktls"><code>stream:checktls()</code> <!-- --></a></li>
<li><a href="#http.stream_common:localname"><code>stream:localname()</code> <!-- --></a></li>
<li><a href="#http.stream_common:peername"><code>stream:peername()</code> <!-- --></a></li>
<li><a href="#http.stream_common:write_continue"><code>stream:write_continue(timeout)</code> <!-- --></a></li>
<li><a href="#http.stream_common:each_chunk"><code>stream:each_chunk()</code> <!-- --></a></li>
<li><a href="#http.stream_common:get_body_as_string"><code>stream:get_body_as_string(timeout)</code> <!-- --></a></li>
<li><a href="#http.stream_common:save_body_to_file"><code>stream:save_body_to_file(file, timeout)</code> <!-- --></a></li>
<li><a href="#http.stream_common:get_body_as_file"><code>stream:get_body_as_file(timeout)</code> <!-- --></a></li>
<li><a href="#http.stream_common:write_body_from_string"><code>stream:write_body_from_string(str, timeout)</code> <!-- --></a></li>
<li><a href="#http.stream_common:write_body_from_file"><code>stream:write_body_from_file(file, timeout)</code> <!-- --></a></li>
</ul></li>
<li><a href="#http.tls">http.tls</a><ul>
<li><a href="#http.tls.has_alpn"><code>has_alpn</code> <!-- --></a></li>
<li><a href="#http.tls.modern_cipher_list"><code>modern_cipher_list</code> <!-- --></a></li>
<li><a href="#http.tls.intermediate_cipher_list"><code>intermediate_cipher_list</code> <!-- --></a></li>
<li><a href="#http.tls.banned_ciphers"><code>banned_ciphers</code> <!-- --></a></li>
<li><a href="#http.tls.new_client_context"><code>new_client_context()</code> <!-- --></a></li>
<li><a href="#http.tls.new_server_context"><code>new_server_context()</code> <!-- --></a></li>
</ul></li>
<li><a href="#http.util">http.util</a><ul>
<li><a href="#http.util.encodeURI"><code>encodeURI(str)</code> <!-- --></a></li>
<li><a href="#http.util.encodeURIComponent"><code>encodeURIComponent(str)</code> <!-- --></a></li>
<li><a href="#http.util.decodeURI"><code>decodeURI(str)</code> <!-- --></a></li>
<li><a href="#http.util.decodeURIComponent"><code>decodeURIComponent(str)</code> <!-- --></a></li>
<li><a href="#http.util.query_args"><code>query_args(str)</code> <!-- --></a></li>
<li><a href="#http.util.resolve_relative_path"><code>resolve_relative_path(orig_path, relative_path)</code> <!-- --></a></li>
<li><a href="#http.util.scheme_to_port"><code>scheme_to_port</code> <!-- --></a></li>
<li><a href="#http.util.split_authority"><code>split_authority(authority, scheme)</code> <!-- --></a></li>
<li><a href="#http.util.to_authority"><code>to_authority(host, port, scheme)</code> <!-- --></a></li>
<li><a href="#http.util.split_header"><code>split_header(str)</code> <!-- --></a></li>
<li><a href="#http.util.imf_date"><code>imf_date(time)</code> <!-- --></a></li>
</ul></li>
<li><a href="#http.zlib">http.zlib</a><ul>
<li><a href="#http.zlib.engine"><code>engine</code> <!-- --></a></li>
<li><a href="#http.zlib.inflate"><code>inflate()</code> <!-- --></a></li>
<li><a href="#http.zlib.deflate"><code>deflate()</code> <!-- --></a></li>
<li><a href="#http.zlib-example">Example</a></li>
</ul></li>
<li><a href="#http.compat.prosody">http.compat.prosody</a><ul>
<li><a href="#http.compat.prosody.request"><code>request(url, ex, callback)</code> <!-- --></a></li>
<li><a href="#http.compat.prosody-example">Example</a></li>
</ul></li>
</ul></li>
<li><a href="#links">Links</a></li>
</ul>
</nav>
</div>
<main>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>lua-http is an HTTP library for Lua, it supports: both client and server operations, both HTTP 1 and HTTP 2.</p>
<section id="conventions" class="level2">
<h2>Conventions</h2>
<p>Operations that may block the current coroutine take an optional timeout.</p>
<p>HTTP 1 request and status line fields are passed around inside of <a href="#http.headers">headers</a> objects under keys <code>&quot;:authority&quot;</code>, <code>&quot;:method&quot;</code>, <code>&quot;:path&quot;</code>, <code>&quot;:scheme&quot;</code> and <code>&quot;:status&quot;</code> as defined in HTTP 2. As such, they are all kept in string form (important to remember for the <code>:status</code> field).</p>
<p>Header fields should always be used with lower case keys.</p>
<section id="errors" class="level3">
<h3>Errors</h3>
<p>Invalid function parameters will throw a lua error (if validated).</p>
<p>Errors are returned as <code>nil, error, errno</code> unless noted otherwise.</p>
<p>Some HTTP 2 operations return/throw special <a href="#http.h2_error">http 2 error objects</a>.</p>
</section>
</section>
<section id="terminology" class="level2">
<h2>Terminology</h2>
<p>Much lua-http terminology is borrowed from HTTP 2.</p>
<p>A <a href="#connection">&quot;connection&quot;</a> is an abstraction over the underlying socket. lua-http has two connection types: one for HTTP 1, one for HTTP 2.</p>
<p>A <a href="#stream">&quot;stream&quot;</a> is a request/response on a connection. lua-http has two stream types: one for <a href="#http.h1_stream">HTTP 1 streams</a>, and one for <a href="#http.h2_stream">HTTP 2 streams</a>. They share a lowest common denominator interface, see <a href="#stream"><em>stream</em></a> and <a href="#http.stream_common"><em>http.stream_common</em></a>.</p>
</section>
<section id="common-use-cases" class="level2">
<h2>Common use cases</h2>
<section id="retrieving-a-document" class="level3">
<h3>Retrieving a document</h3>
<p>The highest level interface for clients is <a href="#http.request"><em>http.request</em></a>. By constructing a <a href="#http.request"><em>request</em></a> object from a uri using <a href="#http.request.new_from_uri"><code>new_from_uri</code></a> and immediately evaluating it, you can easily fetch an HTTP resource.</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> http_request <span class="ot">=</span> <span class="fu">require</span> <span class="st">&quot;http.request&quot;</span>
<span class="kw">local</span> headers<span class="ot">,</span> stream <span class="ot">=</span> <span class="fu">assert</span><span class="ot">(</span>http_request<span class="ot">.</span>new_from_uri<span class="ot">(</span><span class="st">&quot;http://example.com&quot;</span><span class="ot">)</span>:go<span class="ot">())</span>
<span class="kw">local</span> body <span class="ot">=</span> <span class="fu">assert</span><span class="ot">(</span>stream:get_body_as_string<span class="ot">())</span>
<span class="kw">if</span> headers:get <span class="st">&quot;:status&quot;</span> <span class="ot">~=</span> <span class="st">&quot;200&quot;</span> <span class="kw">then</span>
    <span class="fu">error</span><span class="ot">(</span>body<span class="ot">)</span>
<span class="kw">end</span>
<span class="fu">print</span><span class="ot">(</span>body<span class="ot">)</span></code></pre></div>
</section>
</section>
<section id="asynchronous-operation" class="level2">
<h2>Asynchronous Operation</h2>
<p>All lua-http operations including DNS lookup, socket connection, TLS negotiation and read/write operations are all asynchronous when run inside of a cqueue. <a href="http://25thandclement.com/~william/projects/cqueues.html">Cqueues</a> is a lua library that allows for composable event loops. Cqueues can be integrated with almost any main loop or event library you may encounter (see <a href="https://github.com/wahern/cqueues/wiki/Integrations-with-other-main-loops">here</a> for more information + samples), and hence lua-http can be asynchronous in any place you write lua!</p>
</section>
</section>
<section id="interfaces" class="level1">
<h1>Interfaces</h1>
<section id="connection" class="level2">
<h2>connection</h2>
<p>All connection types expose the fields:</p>
<section id="connection.type" class="level3">
<h3><code>connection.type</code> <!-- --></h3>
<p>Either <code>&quot;client&quot;</code> or <code>&quot;server&quot;</code></p>
</section>
<section id="connection.version" class="level3">
<h3><code>connection.version</code> <!-- --></h3>
<p>The HTTP version as a number</p>
</section>
</section>
<section id="stream" class="level2">
<h2>stream</h2>
<p>All stream types expose the following fields and functions. These are extended via the functions in <a href="#http.stream_common">http.stream_common</a>.</p>
<section id="stream.connection" class="level3">
<h3><code>stream.connection</code> <!-- --></h3>
<p>The underlying <a href="#connection"><em>connection</em></a> object</p>
</section>
<section id="stream:get_headers" class="level3">
<h3><code>stream:get_headers(timeout)</code> <!-- --></h3>
</section>
<section id="stream:write_headers" class="level3">
<h3><code>stream:write_headers(headers, end_stream, timeout)</code> <!-- --></h3>
</section>
<section id="stream:get_next_chunk" class="level3">
<h3><code>stream:get_next_chunk(timeout)</code> <!-- --></h3>
</section>
<section id="stream:write_chunk" class="level3">
<h3><code>stream:write_chunk(chunk, end_stream, timeout)</code> <!-- --></h3>
</section>
<section id="stream:shutdown" class="level3">
<h3><code>stream:shutdown()</code> <!-- --></h3>
</section>
</section>
</section>
<section id="modules" class="level1">
<h1>Modules</h1>
<section id="http.bit" class="level2">
<h2>http.bit</h2>
<p>An abstraction layer over the various lua bit libraries.</p>
<p>Results are only consistent between underlying implementations when parameters and results are in the range of <code>0</code> to <code>0x7fffffff</code>.</p>
<section id="http.bit.band" class="level3">
<h3><code>band(a, b)</code> <!-- --></h3>
</section>
<section id="http.bit.bor" class="level3">
<h3><code>bor(a, b)</code> <!-- --></h3>
</section>
<section id="http.bit.bxor" class="level3">
<h3><code>bxor(a, b)</code> <!-- --></h3>
</section>
<section id="http.bit-example" class="level3">
<h3>Example</h3>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> bit <span class="ot">=</span> <span class="fu">require</span> <span class="st">&quot;http.bit&quot;</span>
<span class="fu">print</span><span class="ot">(</span>bit<span class="ot">.</span>band<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">))</span> <span class="co">--&gt; 1</span></code></pre></div>
</section>
</section>
<section id="http.client" class="level2">
<h2>http.client</h2>
<p>Deals with obtaining a connection to an HTTP server.</p>
<section id="http.client.connect" class="level3">
<h3><code>connect(options, timeout)</code> <!-- --></h3>
<p>Creates a new connection to an HTTP server. Can try to negotiate HTTP2 if possible, but</p>
<ul>
<li><p><code>options</code> is a table containing:</p>
<ul>
<li><p><code>family</code> (integer, optional): socket family to use.<br />
defaults to <code>AF_INET</code></p></li>
<li><p><code>host</code> (string): host to connect to.<br />
may be either a hostname or an ip address</p></li>
<li><p><code>port</code> (string|integer): port to connect to in numeric form<br />
e.g. <code>&quot;80&quot;</code> or <code>80</code></p></li>
<li><code>sendname</code> (string|boolean, optional): the <a href="https://en.wikipedia.org/wiki/Server_Name_Indication">TLS SNI</a> host to send.<br />
defaults to <code>true</code>
<ul>
<li><code>true</code> indicates to copy the <code>host</code> field</li>
<li><code>false</code> disables SNI</li>
</ul></li>
<li><p><code>v6only</code> (boolean, optional): if the <code>IPV6_V6ONLY</code> flag should be set on the underlying socket.<br />
defaults to <code>false</code></p></li>
<li><p><code>tls</code> (boolean|userdata, optional): the <code>SSL_CTX*</code> to use, or a boolean to indicate the default TLS context.<br />
defaults to <code>true</code>.</p>
<ul>
<li><code>true</code> indicates to use the default TLS settings, see <a href="#http.tls"><em>http.tls</em></a> for information.</li>
<li><code>false</code> means do not negotiate TLS</li>
</ul></li>
<li><code>version</code> (nil|1.0|1.1|2): HTTP version to use.
<ul>
<li><code>nil</code>: attempts HTTP 2 and falls back to HTTP 1.1</li>
<li><code>1.0</code></li>
<li><code>1.1</code></li>
<li><code>2</code></li>
</ul></li>
<li><p><code>h2_settings</code> (table, optional): HTTP 2 settings to use.<br />
See <a href="#http.h2_connection"><em>http.h2_connection</em></a> for details</p></li>
</ul></li>
<li><p><code>timeout</code> (optional) is the maximum amount of time (in seconds) to allow for connection to be established.</p>
<p>This includes time for DNS lookup, connection, TLS negotiation (if tls enabled) and in the case of HTTP2: settings exchange.</p></li>
</ul>
</section>
<section id="http.client-example" class="level3">
<h3>Example</h3>
<p>Connect to a local http server running on port 8000</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> http_client <span class="ot">=</span> <span class="fu">require</span> <span class="st">&quot;http.client&quot;</span>
<span class="kw">local</span> myconnection <span class="ot">=</span> http_client<span class="ot">.</span>connect <span class="ot">{</span>
    host <span class="ot">=</span> <span class="st">&quot;localhost&quot;</span><span class="ot">;</span>
    port <span class="ot">=</span> <span class="dv">8000</span><span class="ot">;</span>
    tls <span class="ot">=</span> <span class="kw">false</span><span class="ot">;</span>
<span class="ot">}</span></code></pre></div>
</section>
</section>
<section id="http.h1_connection" class="level2">
<h2>http.h1_connection</h2>
<section id="http.h1_connection.new" class="level3">
<h3><code>new(socket, conn_type, version)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:checktls" class="level3">
<h3><code>h1_connection:checktls()</code> <!-- --></h3>
</section>
<section id="http.h1_connection:localname" class="level3">
<h3><code>h1_connection:localname()</code> <!-- --></h3>
</section>
<section id="http.h1_connection:peername" class="level3">
<h3><code>h1_connection:peername()</code> <!-- --></h3>
</section>
<section id="http.h1_connection:clearerr" class="level3">
<h3><code>h1_connection:clearerr(...)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:take_socket" class="level3">
<h3><code>h1_connection:take_socket()</code> <!-- --></h3>
</section>
<section id="http.h1_connection:shutdown" class="level3">
<h3><code>h1_connection:shutdown(dir)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:close" class="level3">
<h3><code>h1_connection:close()</code> <!-- --></h3>
</section>
<section id="http.h1_connection:new_stream" class="level3">
<h3><code>h1_connection:new_stream()</code> <!-- --></h3>
</section>
<section id="http.h1_connection:get_next_incoming_stream" class="level3">
<h3><code>h1_connection:get_next_incoming_stream(timeout)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:read_request_line" class="level3">
<h3><code>h1_connection:read_request_line(timeout)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:read_status_line" class="level3">
<h3><code>h1_connection:read_status_line(timeout)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:read_header" class="level3">
<h3><code>h1_connection:read_header(timeout)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:read_headers_done" class="level3">
<h3><code>h1_connection:read_headers_done(timeout)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:read_body_by_length" class="level3">
<h3><code>h1_connection:read_body_by_length(len, timeout)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:read_body_till_close" class="level3">
<h3><code>h1_connection:read_body_till_close(timeout)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:read_body_chunk" class="level3">
<h3><code>h1_connection:read_body_chunk(timeout)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:write_request_line" class="level3">
<h3><code>h1_connection:write_request_line(method, path, httpversion, timeout)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:write_status_line" class="level3">
<h3><code>h1_connection:write_status_line(httpversion, status_code, reason_phrase, timeout)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:write_header" class="level3">
<h3><code>h1_connection:write_header(k, v, timeout)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:write_headers_done" class="level3">
<h3><code>h1_connection:write_headers_done(timeout)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:write_body_chunk" class="level3">
<h3><code>h1_connection:write_body_chunk(chunk, chunk_ext, timeout)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:write_body_last_chunk" class="level3">
<h3><code>h1_connection:write_body_last_chunk(chunk_ext, timeout)</code> <!-- --></h3>
</section>
<section id="http.h1_connection:write_body_plain" class="level3">
<h3><code>h1_connection:write_body_plain(body, timeout)</code> <!-- --></h3>
</section>
</section>
<section id="http.h1_reason_phrases" class="level2">
<h2>http.h1_reason_phrases</h2>
<p>A table mapping from status codes (as strings) to reason phrases for HTTP 1.</p>
<p>Unknown status codes return <code>&quot;Unassigned&quot;</code></p>
<section id="http.h1_reason_phrases-example" class="level3">
<h3>Example</h3>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> reason_phrases <span class="ot">=</span> <span class="fu">require</span> <span class="st">&quot;http.h1_reason_phrases&quot;</span>
<span class="fu">print</span><span class="ot">(</span>reason_phrases<span class="ot">[</span><span class="st">&quot;200&quot;</span><span class="ot">])</span> <span class="co">--&gt; &quot;OK&quot;</span>
<span class="fu">print</span><span class="ot">(</span>reason_phrases<span class="ot">[</span><span class="st">&quot;342&quot;</span><span class="ot">])</span> <span class="co">--&gt; &quot;Unassigned&quot;</span></code></pre></div>
</section>
</section>
<section id="http.h1_stream" class="level2">
<h2>http.h1_stream</h2>
<p>In addition to following the <a href="#stream"><em>stream</em></a> interface and the methods from <a href="#http.stream_common">http.stream_common</a>, an <code>http.h1_stream</code> has the following methods:</p>
<section id="http.h1_stream:set_state" class="level3">
<h3><code>h1_stream:set_state(new)</code> <!-- --></h3>
</section>
<section id="http.h1_stream:read_headers" class="level3">
<h3><code>h1_stream:read_headers(timeout)</code> <!-- --></h3>
</section>
</section>
<section id="http.h2_connection" class="level2">
<h2>http.h2_connection</h2>
<p>An HTTP 2 connection can have multiple streams active and transmitting data at once, hence an <code>http.h2_connection</code> acts much like a scheduler.</p>
<section id="http.h2_connection.new" class="level3">
<h3><code>new(socket, conn_type, settings, timeout)</code> <!-- --></h3>
</section>
<section id="http.h2_connection:pollfd" class="level3">
<h3><code>h2_connection:pollfd()</code> <!-- --></h3>
</section>
<section id="http.h2_connection:events" class="level3">
<h3><code>h2_connection:events()</code> <!-- --></h3>
</section>
<section id="http.h2_connection:timeout" class="level3">
<h3><code>h2_connection:timeout()</code> <!-- --></h3>
</section>
<section id="http.h2_connection:empty" class="level3">
<h3><code>h2_connection:empty()</code> <!-- --></h3>
</section>
<section id="http.h2_connection:step" class="level3">
<h3><code>h2_connection:step(timeout)</code> <!-- --></h3>
</section>
<section id="http.h2_connection:loop" class="level3">
<h3><code>h2_connection:loop(timeout)</code> <!-- --></h3>
</section>
<section id="http.h2_connection:checktls" class="level3">
<h3><code>h2_connection:checktls()</code> <!-- --></h3>
</section>
<section id="http.h2_connection:localname" class="level3">
<h3><code>h2_connection:localname()</code> <!-- --></h3>
</section>
<section id="http.h2_connection:peername" class="level3">
<h3><code>h2_connection:peername()</code> <!-- --></h3>
</section>
<section id="http.h2_connection:shutdown" class="level3">
<h3><code>h2_connection:shutdown()</code> <!-- --></h3>
</section>
<section id="http.h2_connection:close" class="level3">
<h3><code>h2_connection:close()</code> <!-- --></h3>
</section>
<section id="http.h2_connection:new_stream" class="level3">
<h3><code>h2_connection:new_stream(id)</code> <!-- --></h3>
</section>
<section id="http.h2_connection:get_next_incoming_stream" class="level3">
<h3><code>h2_connection:get_next_incoming_stream(timeout)</code> <!-- --></h3>
</section>
<section id="http.h2_connection:read_http2_frame" class="level3">
<h3><code>h2_connection:read_http2_frame(timeout)</code> <!-- --></h3>
</section>
<section id="http.h2_connection:write_http2_frame" class="level3">
<h3><code>h2_connection:write_http2_frame(typ, flags, streamid, payload, timeout)</code> <!-- --></h3>
</section>
<section id="http.h2_connection:ping" class="level3">
<h3><code>h2_connection:ping(timeout)</code> <!-- --></h3>
</section>
<section id="http.h2_connection:write_window_update" class="level3">
<h3><code>h2_connection:write_window_update(inc, timeout)</code> <!-- --></h3>
</section>
<section id="http.h2_connection:write_goaway_frame" class="level3">
<h3><code>h2_connection:write_goaway_frame(last_stream_id, err_code, debug_msg)</code> <!-- --></h3>
</section>
<section id="http.h2_connection:set_peer_settings" class="level3">
<h3><code>h2_connection:set_peer_settings(peer_settings)</code> <!-- --></h3>
</section>
<section id="http.h2_connection:ack_settings" class="level3">
<h3><code>h2_connection:ack_settings()</code> <!-- --></h3>
</section>
<section id="http.h2_connection:settings" class="level3">
<h3><code>h2_connection:settings(tbl, timeout)</code> <!-- --></h3>
</section>
</section>
<section id="http.h2_error" class="level2">
<h2>http.h2_error</h2>
<p>A type of error object that encapsulates HTTP 2 error information. An <code>http.h2_error</code> object has fields:</p>
<ul>
<li><code>name</code>: The error name: a short identifier for this error</li>
<li><code>code</code>: The error code</li>
<li><code>description</code>: The description of the error code</li>
<li><code>message</code>: An error message</li>
<li><code>traceback</code>: A traceback taken at the point the error was thrown</li>
<li><code>stream_error</code>: A boolean that indicates if this is a stream level or protocol level error</li>
</ul>
<section id="http.h2_error.errors" class="level3">
<h3><code>errors</code> <!-- --></h3>
<p>A table containing errors <a href="https://http2.github.io/http2-spec/#iana-errors">as defined by the HTTP 2 specification</a>. It can be indexed by error name (e.g. <code>errors.PROTOCOL_ERROR</code>) or numeric code (e.g. <code>errors[0x1]</code>).</p>
</section>
<section id="http.h2_error.is" class="level3">
<h3><code>is(ob)</code> <!-- --></h3>
<p>Returns a boolean indicating if the object <code>ob</code> is an <code>http.h2_error</code> object</p>
</section>
<section id="http.h2_error:new" class="level3">
<h3><code>h2_error:new(ob)</code> <!-- --></h3>
<p>Creates a new error object from the passed table. The table should have the form of an error object i.e. with fields <code>name</code>, <code>code</code>, <code>message</code>, <code>traceback</code>, etc.</p>
<p>Fields <code>name</code>, <code>code</code> and <code>description</code> are inherited from the parent <code>h2_error</code> object if not specified.</p>
<p><code>stream_error</code> defaults to <code>false</code>.</p>
</section>
<section id="http.h2_error:traceback" class="level3">
<h3><code>h2_error:traceback(message, stream_error, lvl)</code> <!-- --></h3>
<p>Creates a new error object, recording a traceback from the current thread.</p>
</section>
<section id="http.h2_error:error" class="level3">
<h3><code>h2_error:error(message, stream_error, lvl)</code> <!-- --></h3>
<p>Creates and throws a new error.</p>
</section>
<section id="http.h2_error:assert" class="level3">
<h3><code>h2_error:assert(cond, ...)</code> <!-- --></h3>
<p>If <code>cond</code> is truthy, returns <code>cond, ...</code></p>
<p>If <code>cond</code> is falsy (i.e. <code>false</code> or <code>nil</code>), throws an error with the first element of <code>...</code> as the <code>message</code>.</p>
</section>
</section>
<section id="http.h2_stream" class="level2">
<h2>http.h2_stream</h2>
<p>In addition to following the <a href="#stream"><em>stream</em></a> interface and the methods from <a href="#http.stream_common">http.stream_common</a>, an <code>http.h2_stream</code> has the following methods:</p>
<section id="http.h2_stream:set_state" class="level3">
<h3><code>h2_stream:set_state(new)</code> <!-- --></h3>
</section>
<section id="http.h2_stream:reprioritise" class="level3">
<h3><code>h2_stream:reprioritise(child, exclusive)</code> <!-- --></h3>
</section>
<section id="http.h2_stream:write_http2_frame" class="level3">
<h3><code>h2_stream:write_http2_frame(typ, flags, payload, timeout)</code> <!-- --></h3>
</section>
<section id="http.h2_stream:write_data_frame" class="level3">
<h3><code>h2_stream:write_data_frame(payload, end_stream, padded, timeout)</code> <!-- --></h3>
</section>
<section id="http.h2_stream:write_headers_frame" class="level3">
<h3><code>h2_stream:write_headers_frame(payload, end_stream, end_headers, padded, exclusive, stream_dep, weight, timeout)</code> <!-- --></h3>
</section>
<section id="http.h2_stream:write_rst_stream" class="level3">
<h3><code>h2_stream:write_rst_stream(err_code, timeout)</code> <!-- --></h3>
</section>
<section id="http.h2_stream:write_settings_frame" class="level3">
<h3><code>h2_stream:write_settings_frame(ACK, settings, timeout)</code> <!-- --></h3>
</section>
<section id="http.h2_stream:write_ping_frame" class="level3">
<h3><code>h2_stream:write_ping_frame(ACK, payload, timeout)</code> <!-- --></h3>
</section>
<section id="http.h2_stream:write_goaway_frame" class="level3">
<h3><code>h2_stream:write_goaway_frame(last_streamid, err_code, debug_msg, timeout)</code> <!-- --></h3>
</section>
<section id="http.h2_stream:write_window_update_frame" class="level3">
<h3><code>h2_stream:write_window_update_frame(inc, timeout)</code> <!-- --></h3>
</section>
<section id="http.h2_stream:write_window_update" class="level3">
<h3><code>h2_stream:write_window_update(inc)</code> <!-- --></h3>
</section>
<section id="http.h2_stream:write_continuation_frame" class="level3">
<h3><code>h2_stream:write_continuation_frame(payload, end_headers, timeout)</code> <!-- --></h3>
</section>
</section>
<section id="http.headers" class="level2">
<h2>http.headers</h2>
<p>An ordered list of header fields. Each field has a <em>name</em>, a <em>value</em> and a <em>never_index</em> flag that indicates if the header field is potentially sensitive data.</p>
<p>Each headers object has an index by field name to efficiently retrieve values by key. Keep in mind that there can be multiple values for a given field name. (e.g. an HTTP server may send two <code>Set-Cookie</code> headers).</p>
<section id="http.headers.new" class="level3">
<h3><code>new()</code> <!-- --></h3>
<p>Creates and returns a new headers object.</p>
</section>
<section id="http.headers:len" class="level3">
<h3><code>headers:len()</code> <!-- --></h3>
</section>
<section id="http.headers:clone" class="level3">
<h3><code>headers:clone()</code> <!-- --></h3>
</section>
<section id="http.headers:append" class="level3">
<h3><code>headers:append(name, value, never_index)</code> <!-- --></h3>
</section>
<section id="http.headers:each" class="level3">
<h3><code>headers:each()</code> <!-- --></h3>
</section>
<section id="http.headers:has" class="level3">
<h3><code>headers:has(name)</code> <!-- --></h3>
</section>
<section id="http.headers:delete" class="level3">
<h3><code>headers:delete(name)</code> <!-- --></h3>
</section>
<section id="http.headers:geti" class="level3">
<h3><code>headers:geti(i)</code> <!-- --></h3>
</section>
<section id="http.headers:get_as_sequence" class="level3">
<h3><code>headers:get_as_sequence(name)</code> <!-- --></h3>
</section>
<section id="http.headers:get" class="level3">
<h3><code>headers:get(name)</code> <!-- --></h3>
</section>
<section id="http.headers:get_comma_separated" class="level3">
<h3><code>headers:get_comma_separated(name)</code> <!-- --></h3>
</section>
<section id="http.headers:get_split_as_sequence" class="level3">
<h3><code>headers:get_split_as_sequence(name)</code> <!-- --></h3>
</section>
<section id="http.headers:modifyi" class="level3">
<h3><code>headers:modifyi(i, value, never_index)</code> <!-- --></h3>
</section>
<section id="http.headers:upsert" class="level3">
<h3><code>headers:upsert(name, value, never_index)</code> <!-- --></h3>
</section>
<section id="http.headers:sort" class="level3">
<h3><code>headers:sort()</code> <!-- --></h3>
</section>
</section>
<section id="http.hpack" class="level2">
<h2>http.hpack</h2>
<section id="http.hpack.new" class="level3">
<h3><code>new(SETTINGS_HEADER_TABLE_SIZE)</code> <!-- --></h3>
</section>
<section id="http.hpack:append_data" class="level3">
<h3><code>hpack_context:append_data(val)</code> <!-- --></h3>
</section>
<section id="http.hpack:render_data" class="level3">
<h3><code>hpack_context:render_data()</code> <!-- --></h3>
</section>
<section id="http.hpack:clear_data" class="level3">
<h3><code>hpack_context:clear_data()</code> <!-- --></h3>
</section>
<section id="http.hpack:evict_from_dynamic_table" class="level3">
<h3><code>hpack_context:evict_from_dynamic_table()</code> <!-- --></h3>
</section>
<section id="http.hpack:dynamic_table_tostring" class="level3">
<h3><code>hpack_context:dynamic_table_tostring()</code> <!-- --></h3>
</section>
<section id="http.hpack:set_max_dynamic_table_size" class="level3">
<h3><code>hpack_context:set_max_dynamic_table_size(SETTINGS_HEADER_TABLE_SIZE)</code> <!-- --></h3>
</section>
<section id="http.hpack:encode_max_size" class="level3">
<h3><code>hpack_context:encode_max_size(val)</code> <!-- --></h3>
</section>
<section id="http.hpack:resize_dynamic_table" class="level3">
<h3><code>hpack_context:resize_dynamic_table(new_size)</code> <!-- --></h3>
</section>
<section id="http.hpack:add_to_dynamic_table" class="level3">
<h3><code>hpack_context:add_to_dynamic_table(name, value, k) -- luacheck: ignore 212</code> <!-- --></h3>
</section>
<section id="http.hpack:dynamic_table_id_to_index" class="level3">
<h3><code>hpack_context:dynamic_table_id_to_index(id)</code> <!-- --></h3>
</section>
<section id="http.hpack:lookup_pair_index" class="level3">
<h3><code>hpack_context:lookup_pair_index(k)</code> <!-- --></h3>
</section>
<section id="http.hpack:lookup_name_index" class="level3">
<h3><code>hpack_context:lookup_name_index(name)</code> <!-- --></h3>
</section>
<section id="http.hpack:lookup_index" class="level3">
<h3><code>hpack_context:lookup_index(index, allow_single)</code> <!-- --></h3>
</section>
<section id="http.hpack:add_header_indexed" class="level3">
<h3><code>hpack_context:add_header_indexed(name, value, huffman)</code> <!-- --></h3>
</section>
<section id="http.hpack:add_header_never_indexed" class="level3">
<h3><code>hpack_context:add_header_never_indexed(name, value, huffman)</code> <!-- --></h3>
</section>
<section id="http.hpack:encode_headers" class="level3">
<h3><code>hpack_context:encode_headers(headers)</code> <!-- --></h3>
</section>
<section id="http.hpack:decode_headers" class="level3">
<h3><code>hpack_context:decode_headers(payload, header_list, pos)</code> <!-- --></h3>
</section>
</section>
<section id="http.request" class="level2">
<h2>http.request</h2>
<section id="http.request.new_from_uri" class="level3">
<h3><code>new_from_uri(uri)</code> <!-- --></h3>
<p>Creates a new <code>http.request</code> object from the given URI.</p>
</section>
<section id="http.request.new_connect" class="level3">
<h3><code>new_connect(uri, connect_authority)</code> <!-- --></h3>
<p>Creates a new <code>http.request</code> object from the given URI that will perform a <em>CONNECT</em> request.</p>
</section>
<section id="http.request.host" class="level3">
<h3><code>request.host</code> <!-- --></h3>
<p>The host this request should be sent to.</p>
</section>
<section id="http.request.port" class="level3">
<h3><code>request.port</code> <!-- --></h3>
<p>The port this request should be sent to.</p>
</section>
<section id="http.request.tls" class="level3">
<h3><code>request.tls</code> <!-- --></h3>
<p>A boolean indicating if TLS should be used, or an <code>SSL_CTX*</code> to use.</p>
</section>
<section id="http.request.sendname" class="level3">
<h3><code>request.sendname</code> <!-- --></h3>
<p>The TLS SNI host name used.</p>
</section>
<section id="http.request.version" class="level3">
<h3><code>request.version</code> <!-- --></h3>
<p>The HTTP version to use; leave as <code>nil</code> to auto-select.</p>
</section>
<section id="http.request.headers" class="level3">
<h3><code>request.headers</code> <!-- --></h3>
<p>A <a href="#http.headers"><em>http.headers</em></a> object of headers that will be sent in the request.</p>
</section>
<section id="http.request.follow_redirects" class="level3">
<h3><code>request.follow_redirects</code> <!-- --></h3>
<p>Boolean indicating if <code>:go()</code> should follow redirects. Defaults to <code>true</code>.</p>
</section>
<section id="http.request.max_redirects" class="level3">
<h3><code>request.max_redirects</code> <!-- --></h3>
<p>Maximum number of redirects to follow before giving up. Defaults to <code>5</code>. Set to <code>false</code> to not give up.</p>
</section>
<section id="http.request.expect_100_timeout" class="level3">
<h3><code>request.expect_100_timeout</code> <!-- --></h3>
<p>Number of seconds to wait for a 100 Continue response before proceeding to send a request body. Defaults to <code>1</code>.</p>
</section>
<section id="http.request:set_body" class="level3">
<h3><code>request:set_body(body)</code> <!-- --></h3>
<p>Allows setting a request body. <code>body</code> may be a string, function or lua file object.</p>
<ul>
<li>If <code>body</code> is a string it will be sent as given.</li>
<li>If <code>body</code> is a function, it will be called repeatedly with the current time remaining and should return chunks of the request body as a string or <code>nil</code> if done.</li>
<li>If <code>body</code> is a lua file object, it will be <a href="http://www.lua.org/manual/5.3/manual.html#pdf-file:seek"><code>:seek</code>'d</a> to the start, then sent as a body. Any errors encountered during file operations <strong>will be thrown</strong>.</li>
</ul>
</section>
<section id="http.request:timeout" class="level3">
<h3><code>request:go(timeout)</code> <!-- --></h3>
<p>Performs the request.</p>
<p>The request object is <strong>not</strong> invalidated; and can be reused for a new request. On success, returns the response <a href="#http.headers"><em>headers</em></a> and a <a href="#stream"><em>stream</em></a>.</p>
</section>
</section>
<section id="http.server" class="level2">
<h2>http.server</h2>
<section id="http.client.connect" class="level3">
<h3><code>listen(options)</code> <!-- --></h3>
</section>
</section>
<section id="http.stream_common" class="level2">
<h2>http.stream_common</h2>
<p>The module <code>http.stream_common</code> provides common functions for streams (no matter the underlying protocol version). It exports a table <code>methods</code> of functions that build on top of the lower level <a href="#stream"><em>stream</em></a> interface.</p>
<section id="http.stream_common:checktls" class="level3">
<h3><code>stream:checktls()</code> <!-- --></h3>
<p>Convenience wrapper equivalent to <code>stream.connection:checktls()</code></p>
</section>
<section id="http.stream_common:localname" class="level3">
<h3><code>stream:localname()</code> <!-- --></h3>
<p>Convenience wrapper equivalent to <code>stream.connection:localname()</code></p>
</section>
<section id="http.stream_common:peername" class="level3">
<h3><code>stream:peername()</code> <!-- --></h3>
<p>Convenience wrapper equivalent to <code>stream.connection:peername()</code></p>
</section>
<section id="http.stream_common:write_continue" class="level3">
<h3><code>stream:write_continue(timeout)</code> <!-- --></h3>
<p>Sends a 100-continue header block.</p>
</section>
<section id="http.stream_common:each_chunk" class="level3">
<h3><code>stream:each_chunk()</code> <!-- --></h3>
<p>Iterator over <a href="#stream:get_next_chunk"><code>stream:get_next_chunk()</code></a></p>
</section>
<section id="http.stream_common:get_body_as_string" class="level3">
<h3><code>stream:get_body_as_string(timeout)</code> <!-- --></h3>
</section>
<section id="http.stream_common:save_body_to_file" class="level3">
<h3><code>stream:save_body_to_file(file, timeout)</code> <!-- --></h3>
</section>
<section id="http.stream_common:get_body_as_file" class="level3">
<h3><code>stream:get_body_as_file(timeout)</code> <!-- --></h3>
</section>
<section id="http.stream_common:write_body_from_string" class="level3">
<h3><code>stream:write_body_from_string(str, timeout)</code> <!-- --></h3>
</section>
<section id="http.stream_common:write_body_from_file" class="level3">
<h3><code>stream:write_body_from_file(file, timeout)</code> <!-- --></h3>
</section>
</section>
<section id="http.tls" class="level2">
<h2>http.tls</h2>
<section id="http.tls.has_alpn" class="level3">
<h3><code>has_alpn</code> <!-- --></h3>
<p>Boolean indicating if ALPN is available in the current environment.</p>
<p>It may be disabled if OpenSSL was compiled without ALPN support, or is an old version.</p>
</section>
<section id="http.tls.modern_cipher_list" class="level3">
<h3><code>modern_cipher_list</code> <!-- --></h3>
<p>The <a href="https://wiki.mozilla.org/Security/Server_Side_TLS#Modern_compatibility">Mozilla &quot;Modern&quot; cipher list</a> as a colon seperated list, ready to pass to OpenSSL</p>
</section>
<section id="http.tls.intermediate_cipher_list" class="level3">
<h3><code>intermediate_cipher_list</code> <!-- --></h3>
<p>The <a href="https://wiki.mozilla.org/Security/Server_Side_TLS#Intermediate_compatibility_.28default.29">Mozilla &quot;Intermediate&quot; cipher list</a> as a colon seperated list, ready to pass to OpenSSL</p>
</section>
<section id="http.tls.banned_ciphers" class="level3">
<h3><code>banned_ciphers</code> <!-- --></h3>
<p>A set (table with string keys and values of <code>true</code>) of the <a href="https://http2.github.io/http2-spec/#BadCipherSuites">ciphers banned in HTTP 2</a> where the keys are OpenSSL cipher names. Ciphers not known by OpenSSL are missing from the set.</p>
</section>
<section id="http.tls.new_client_context" class="level3">
<h3><code>new_client_context()</code> <!-- --></h3>
</section>
<section id="http.tls.new_server_context" class="level3">
<h3><code>new_server_context()</code> <!-- --></h3>
</section>
</section>
<section id="http.util" class="level2">
<h2>http.util</h2>
<section id="http.util.encodeURI" class="level3">
<h3><code>encodeURI(str)</code> <!-- --></h3>
</section>
<section id="http.util.encodeURIComponent" class="level3">
<h3><code>encodeURIComponent(str)</code> <!-- --></h3>
</section>
<section id="http.util.decodeURI" class="level3">
<h3><code>decodeURI(str)</code> <!-- --></h3>
</section>
<section id="http.util.decodeURIComponent" class="level3">
<h3><code>decodeURIComponent(str)</code> <!-- --></h3>
</section>
<section id="http.util.query_args" class="level3">
<h3><code>query_args(str)</code> <!-- --></h3>
<p>Returns an iterator over the pairs in <code>str</code></p>
<section id="example" class="level4">
<h4>Example</h4>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> http_util <span class="ot">=</span> <span class="fu">require</span> <span class="st">&quot;http.util&quot;</span>
<span class="kw">for</span> name<span class="ot">,</span> value <span class="kw">in</span> http_util<span class="ot">.</span>query_args<span class="ot">(</span><span class="st">&quot;foo=bar&amp;baz=qux&quot;</span><span class="ot">)</span> <span class="kw">do</span>
    <span class="fu">print</span><span class="ot">(</span>name<span class="ot">,</span> value<span class="ot">)</span>
<span class="kw">end</span>
<span class="co">--[[ prints:</span>
<span class="co">&quot;foo&quot;, &quot;bar&quot;</span>
<span class="co">&quot;baz&quot;, &quot;qux&quot;</span>
<span class="co">]]</span></code></pre></div>
</section>
</section>
<section id="http.util.resolve_relative_path" class="level3">
<h3><code>resolve_relative_path(orig_path, relative_path)</code> <!-- --></h3>
</section>
<section id="http.util.scheme_to_port" class="level3">
<h3><code>scheme_to_port</code> <!-- --></h3>
<p>Map from schemes (as strings) to default ports (as integers).</p>
</section>
<section id="http.util.split_authority" class="level3">
<h3><code>split_authority(authority, scheme)</code> <!-- --></h3>
<p>Splits an <code>authority</code> into host and port components. If the authority has no port component, will attempt to use the default for the <code>scheme</code>.</p>
<section id="example-1" class="level4">
<h4>Example</h4>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> http_util <span class="ot">=</span> <span class="fu">require</span> <span class="st">&quot;http.util&quot;</span>
<span class="fu">print</span><span class="ot">(</span>http_util<span class="ot">.</span>split_authority<span class="ot">(</span><span class="st">&quot;localhost:8000&quot;</span><span class="ot">,</span> <span class="st">&quot;http&quot;</span><span class="ot">))</span> <span class="co">--&gt; &quot;localhost&quot;, 8000</span>
<span class="fu">print</span><span class="ot">(</span>http_util<span class="ot">.</span>split_authority<span class="ot">(</span><span class="st">&quot;example.com&quot;</span><span class="ot">,</span> <span class="st">&quot;https&quot;</span><span class="ot">))</span> <span class="co">--&gt; &quot;localhost&quot;, 443</span></code></pre></div>
</section>
</section>
<section id="http.util.to_authority" class="level3">
<h3><code>to_authority(host, port, scheme)</code> <!-- --></h3>
<p>Joins the <code>host</code> and <code>port</code> to create a valid authority component. Omits the port if it is the default for the <code>scheme</code>.</p>
</section>
<section id="http.util.split_header" class="level3">
<h3><code>split_header(str)</code> <!-- --></h3>
<p>Many HTTP headers are specified to be comma seperated elements with optional whitespace. This function returns a table with a sequence of these elements.</p>
<p>The returned table has an <code>n</code> field containing the number of elements.</p>
</section>
<section id="http.util.imf_date" class="level3">
<h3><code>imf_date(time)</code> <!-- --></h3>
<p>Returns the time in HTTP preferred date format (See <a href="https://tools.ietf.org/html/rfc7231#section-7.1.1.1">RFC 7231 section 7.1.1.1</a>)</p>
<p><code>time</code> defaults to the current time</p>
</section>
</section>
<section id="http.zlib" class="level2">
<h2>http.zlib</h2>
<p>An abstraction layer over the various lua zlib libraries.</p>
<section id="http.zlib.engine" class="level3">
<h3><code>engine</code> <!-- --></h3>
<p>Currently either <a href="https://github.com/brimworks/lua-zlib"><code>&quot;lua-zlib&quot;</code></a> or <a href="https://github.com/LuaDist/lzlib"><code>&quot;lzlib&quot;</code></a></p>
</section>
<section id="http.zlib.inflate" class="level3">
<h3><code>inflate()</code> <!-- --></h3>
<p>Returns a function that inflates (uncompresses) a zlib stream.</p>
<p>The function takes a string of compressed data and an end of stream flag, it returns the uncompressed data as a string. It will throw an error if the stream is invalid</p>
</section>
<section id="http.zlib.deflate" class="level3">
<h3><code>deflate()</code> <!-- --></h3>
<p>Returns a function that deflates (compresses) a zlib stream.</p>
<p>The function takes a string of uncompressed data and an end of stream flag, it returns the compressed data as a string.</p>
</section>
<section id="http.zlib-example" class="level3">
<h3>Example</h3>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> zlib <span class="ot">=</span> <span class="fu">require</span> <span class="st">&quot;http.zlib&quot;</span>
<span class="kw">local</span> original <span class="ot">=</span> <span class="st">&quot;the racecar raced around the racecar track&quot;</span>
<span class="kw">local</span> deflater <span class="ot">=</span> zlib<span class="ot">.</span>deflate<span class="ot">()</span>
<span class="kw">local</span> compressed <span class="ot">=</span> deflater<span class="ot">(</span>original<span class="ot">,</span> <span class="kw">true</span><span class="ot">)</span>
<span class="fu">print</span><span class="ot">(#</span>original<span class="ot">,</span> <span class="ot">#</span>compressed<span class="ot">)</span> <span class="co">-- compressed should be smaller</span>
<span class="kw">local</span> inflater <span class="ot">=</span> zlib<span class="ot">.</span>inflate<span class="ot">()</span>
<span class="kw">local</span> uncompressed <span class="ot">=</span> inflater<span class="ot">(</span>compressed<span class="ot">,</span> <span class="kw">true</span><span class="ot">)</span>
<span class="fu">assert</span><span class="ot">(</span>original <span class="ot">==</span> uncompressed<span class="ot">)</span></code></pre></div>
</section>
</section>
<section id="http.compat.prosody" class="level2">
<h2>http.compat.prosody</h2>
<p>Provides usage similar to <a href="https://prosody.im/doc/developers/net/http">prosody's net.http</a></p>
<section id="http.compat.prosody.request" class="level3">
<h3><code>request(url, ex, callback)</code> <!-- --></h3>
<p>A few key differences to the prosody <code>net.http.request</code>:</p>
<ul>
<li>must be called from within a running cqueue</li>
<li>The callback may be called from a different thread in the cqueue</li>
<li>The returned object will be a <a href="#http.request"><em>http.request</em></a> object
<ul>
<li>This object is passed to the callback on errors and as the 4th argument on success</li>
</ul></li>
<li>The default user-agent will be from lua-http (rather than <code>&quot;Prosody XMPP Server&quot;</code>)</li>
<li>lua-http features (such as HTTP2) will be used where possible</li>
</ul>
</section>
<section id="http.compat.prosody-example" class="level3">
<h3>Example</h3>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> prosody_http <span class="ot">=</span> <span class="fu">require</span> <span class="st">&quot;http.compat.prosody&quot;</span>
<span class="kw">local</span> cqueues <span class="ot">=</span> <span class="fu">require</span> <span class="st">&quot;cqueues&quot;</span>
<span class="kw">local</span> cq <span class="ot">=</span> cqueues<span class="ot">.</span>new<span class="ot">()</span>
cq:wrap<span class="ot">(</span><span class="kw">function</span><span class="ot">()</span>
    prosody_http<span class="ot">.</span>request<span class="ot">(</span><span class="st">&quot;http://httpbin.org/ip&quot;</span><span class="ot">,</span> <span class="ot">{},</span> <span class="kw">function</span><span class="ot">(</span>b<span class="ot">,</span> c<span class="ot">,</span> r<span class="ot">)</span>
        <span class="fu">print</span><span class="ot">(</span>c<span class="ot">)</span> <span class="co">--&gt; 200</span>
        <span class="fu">print</span><span class="ot">(</span>b<span class="ot">)</span> <span class="co">--&gt; {&quot;origin&quot;: &quot;123.123.123.123&quot;}</span>
    <span class="kw">end</span><span class="ot">)</span>
<span class="kw">end</span><span class="ot">)</span>
<span class="fu">assert</span><span class="ot">(</span>cq:loop<span class="ot">())</span></code></pre></div>
</section>
</section>
</section>
<section id="links" class="level1">
<h1>Links</h1>
<ul>
<li><a href="https://github.com/daurnimator/lua-http">Github</a></li>
<li><a href="https://github.com/daurnimator/lua-http/issues">Issue tracker</a></li>
</ul>
</section>
</main>
</body>
</html>
